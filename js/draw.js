// Generated by CoffeeScript 1.6.3
var Bud, Leaf, anRange, bRange, bud, budList, c, cxt, h0, lastW, leaf, leafList, length0, makeBranch, numOfBud, numOfLoop, rLeaf, random, reduceH, reduceL, rootX, rootY, w0, weight0, _i, _j, _len, _len1;

c = document.getElementById("myCanvas");

cxt = c.getContext("2d");

w0 = cxt.canvas.width = window.innerWidth;

h0 = cxt.canvas.height = window.innerHeight;

cxt.fillStyle = "#333333";

cxt.fillRect(0, h0 - 30, w0, 30);

rootX = 0.2 * w0;

rootY = 1.15 * h0;

length0 = 0.4 * h0;

weight0 = w0 / 75;

anRange = Math.PI / 3;

bRange = Math.PI / 3;

reduceL = 0.6;

reduceH = 0.8;

rLeaf = w0 / 150;

numOfLoop = 5;

numOfBud = 7;

Bud = function(X, Y, X0, Y0, w, i) {
  this.X = X;
  this.Y = Y;
  this.X0 = X0;
  this.Y0 = Y0;
  this.w = w;
  return this.i = i;
};

Leaf = function(X, Y, r, i) {
  this.X = X;
  this.Y = Y;
  this.r = r;
  return this.i = i;
};

budList = [];

leafList = [];

random = function(m, n) {
  return Math.random() * (n - m) + m;
};

makeBranch = function(x1, y1, i, l, w, a0, b0) {
  var j, m, n, r, tmp, x2, x3, y2, y3, _i, _j, _ref, _results;
  x2 = x1 - l * Math.sin(a0) * Math.sin(b0);
  y2 = y1 - l * Math.cos(a0) * Math.sin(b0);
  budList.push(new Bud(x2, y2, x1, y1, w, i));
  if (i > 0) {
    for (tmp = _i = 0, _ref = Math.ceil((numOfLoop - i + 1) ^ 2); 0 <= _ref ? _i <= _ref : _i >= _ref; tmp = 0 <= _ref ? ++_i : --_i) {
      m = random(-5, 5 + l * Math.sin(b0));
      n = random(0, w0 / 30 - 3 * i);
      y3 = y1 - (m * Math.cos(a0) + n * Math.sin(a0));
      x3 = x1 - (m * Math.sin(a0) + n * Math.cos(a0));
      r = rLeaf;
      leafList.push(new Leaf(x3, y3, r, i));
    }
  }
  if (i < numOfLoop) {
    _results = [];
    for (j = _j = 1; 1 <= numOfBud ? _j <= numOfBud : _j >= numOfBud; j = 1 <= numOfBud ? ++_j : --_j) {
      _results.push(arguments.callee(x2, y2, i + 1, l * random(reduceL, reduceH), w * random(reduceL - 0.2, reduceH - 0.2), random(-anRange, anRange) + a0, random(-anRange, anRange) + b0));
    }
    return _results;
  }
};

makeBranch(rootX, rootY, 0, length0, weight0, 0, Math.PI / 2);

lastW = budList[0].w;

cxt.lineWidth = lastW;

cxt.beginPath();

for (_i = 0, _len = budList.length; _i < _len; _i++) {
  bud = budList[_i];
  if (bud.w !== lastW) {
    cxt.closePath();
    cxt.stroke();
    lastW = bud.w;
    cxt.lineWidth = bud.w;
    cxt.strokeStyle = "rgba(0,0,0," + (1 - bud.i / numOfLoop / 1.1) + ")";
    cxt.beginPath();
  }
  cxt.moveTo(bud.X, bud.Y);
  cxt.lineTo(bud.X0, bud.Y0);
}

cxt.closePath();

cxt.stroke();

for (_j = 0, _len1 = leafList.length; _j < _len1; _j++) {
  leaf = leafList[_j];
  cxt.beginPath();
  cxt.arc(leaf.X, leaf.Y, leaf.r, 0, 2 * Math.PI);
  cxt.closePath();
  cxt.fillStyle = "rgba(150,0,1, " + 0.1 + ")";
  cxt.fill();
}
